<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
</head>
<body data-theme="light">
    <div class="theme-toggle">
        <button id="toggle-theme">üåû</button>
    </div>
    <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <div id="profile-section">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</p>
        <button id="logout-btn">–í—ã–π—Ç–∏</button>
    </div>

    <h1>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
    <div class="controls">
      <button id="refresh-data">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>
    <div id="data-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logout-btn');

            logoutBtn.addEventListener('click', async () => {
                try {
                    const response = await fetch('/logout', {
                        method: 'POST',
                        credentials: 'include'
                    });

                    const data = await response.json();

                    if (data.success) {
                        window.location.href = '/';
                    }
                } catch (err) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ');
                }
            });

            async function checkAuth() {
                try {
                    const response = await fetch('/check-auth', {
                        credentials: 'include'
                    });

                    const data = await response.json();

                    if (data.authenticated) {
                        document.getElementById('username-display').textContent = data.user.username;
                    } else {
                        window.location.href = '/';
                    }
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', err);
                }
            }

            document.getElementById('toggle-theme').addEventListener('click', () => {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';

                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);

                const themeButton = document.getElementById('toggle-theme');
                themeButton.textContent = newTheme === 'light' ? 'üåû' : 'üåú';
            });

            function loadTheme() {
                const theme = localStorage.getItem('theme') || 'light';
                document.body.setAttribute('data-theme', theme);

                const themeButton = document.getElementById('toggle-theme');
                themeButton.textContent = theme === 'light' ? 'üåû' : 'üåú';
            }

            async function updateData() {
                const response = await fetch('/data');
                const data = await response.json();

                document.getElementById('data-container').innerHTML = `
                  <h3>–î–∞–Ω–Ω—ã–µ API</h3>
                  <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong> ${data.source}</p>
                  <p><strong>–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</strong> ${new Date(data.timestamp).toLocaleTimeString()}</p>
                  <pre>${JSON.stringify(data.items, null, 2)}</pre>
                `;
            }

            document.getElementById('refresh-data').addEventListener('click', updateData);

            loadTheme();
            updateData();
            checkAuth();

            setInterval(updateData, 5000);
        });
    </script>
</body>
</html>
